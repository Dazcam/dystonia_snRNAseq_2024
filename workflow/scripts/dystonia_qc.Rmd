---
title: "Dystonia study - Stiletti data analysis - 2nd Pass - `r toupper(region)`"
author: "Darren Cameron"
date: "`r Sys.Date()`"
output: html_document
---

*** 

### **Thresholds** {.tabset}

+ Biol Psych thresholds set for fetal samples
  + Cells exp < 1000 genes > 5000 genes (used 3 X MAD [high only] for adult)
  + gt 5% mito
  + gt 10% ribo (used 5% for adult)
  + Genes from mito genome excluded
  + Genes expressed in fewer than 3 cells excluded
  + Doublets - will skipped for now as done by Stiletti and likely resource intensive
  + Note: Big difference in UMI / Genes captured across adult and vs. fetal may be worth down-sampling as control / check

***

#### Diagnostics {.tabset}

##### Pre-filter

***

```{r plots_pre_filt, results='asis', fig.dim = c(10,10), echo=FALSE}
qc_plot_noFilt
```

***

```{r counts_pre_filt, results='asis', echo=FALSE}
knitr::kable(counts, caption = paste0("Counts: ", toupper(region)))
```

***

```{r umi_dist_pre_filt, results='asis', echo=FALSE}
knitr::kable(dist_counts_noFilt, caption = paste0("UMI and gene count distribution summary: ", toupper(region)))
```

***

##### Outliers

```{r outlier_plot, results='asis', fig.dim = c(10,10), echo=FALSE}
cell_outlier_plot
```

***

```{r outlier_cnts_tbl, results='asis', echo=FALSE}
knitr::kable(cell_outlier_cnts_tbl, caption = paste0("Cell outlier counts: ", toupper(region)))
```

***

##### Post-filter

***

```{r plots_post_filt, results='asis', fig.dim = c(10,10), echo=FALSE}
qc_plot_post_Filt
```

***

```{r counts_post_filt, results='asis', echo=FALSE}
knitr::kable(counts_post_Filt, caption = paste0("Counts: ", toupper(region)))
```

***

```{r umi_dist_post_filt, results='asis', echo=FALSE}
knitr::kable(dist_counts_post_Filt, caption = paste0("UMI and gene count distribution summary: ", toupper(region)))
```

***

##### Samples

+ We should be running this on individual samples by lane
+ However, due to the number of samples when running it by lane I hit the limit of my resources locally so only only str run by lane so far

***

```{r, meta_col_orig, sample_id, echo=FALSE}
knitr::kable(meta_col_orig, caption = paste0("Samples by 10X run: ", toupper(region)))
```

***

```{r, meta_col_sample, sample_id, echo=FALSE}
knitr::kable(meta_col_sample, caption = paste0("Samples by 10X lane: ", toupper(region)))
```

#### Cluster QC Plots {.tabset}

+ Note that NAs are generated as we're using a Sketch object here (i.e. only 5K cells)
+ Batch effects clear best when using sample id
+ Get cell counts per cluster

***

```{r cluster_qc_plots, results='asis', fig.dim = c(20,20), echo=FALSE}
cluster_qc_plot
```

***

#### Integration Plots {.tabset}

+ Integration should be done on sample ID rather than orig.ident
+ Atm can only run cer and fcx on orig.ident

***

```{r Integration plots, results='asis', fig.dim = c(10,10), echo=FALSE}
integration_plot
```

***

#### PCA {.tabset}

+ PC threshold probs between 30 for Str and Cer, 50 for FCX

```{r pca_plots, results='asis', fig.dim = c(10,10), echo=FALSE}
DimHeatmap(seurat_object, dims = 30:pc_thresh, cells = 500, balanced = TRUE)
```

#### Violin (General) {.tabset}

+ Too many cell types?

```{r vln_general_plots, results='asis', fig.dim = c(10,10), echo=FALSE}
vln_plot_recode
```

***

#### Violin (dystonia genes) {.tabset}

+ Broad expression of dystonia genes, difficult to pull out patterns in this format

```{r vln_dyst_plots, results='asis', fig.dim = c(10,10), echo=FALSE}
vln_plot_recode_dyst
```

#### Cluster umap

```{r cluster_umap, results='asis', fig.dim = c(10,10), echo=FALSE}
umap_recode
```

